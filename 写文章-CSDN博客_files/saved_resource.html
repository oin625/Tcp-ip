<!DOCTYPE html>
<!-- saved from url=(0028)https://mp.csdn.net/postedit -->
<html dir="ltr" lang="zh-cn"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title data-cke-title="所见即所得编辑器, editor">所见即所得编辑器, editor</title><style data-cke-temp="1">html{cursor:text;*cursor:auto}
img,input,textarea{cursor:default}</style><link type="text/css" rel="stylesheet" href="./contents.css"><link type="text/css" rel="stylesheet" href="./ck_htmledit_views-833878f763.css"><link type="text/css" rel="stylesheet" href="./tableselection.css"><link type="text/css" rel="stylesheet" href="./chart.css"><link type="text/css" rel="stylesheet" href="./imagebase.css"><link type="text/css" rel="stylesheet" href="./atom-one-dark.css"><style data-cke-temp="1">.cke_editable{cursor:text}.cke_editable img,.cke_editable input,.cke_editable textarea{cursor:default}
.img-upload-box{margin:0 auto;width:420px;height:80px;-webkit-box-sizing:border-box;box-sizing:border-box;padding:8px;border:1px solid #e0e0e0;background-color:#fff;display:-webkit-box;display:-ms-flexbox;display:flex}.img-upload-box img.preview{display:block;width:64px;height:64px}.img-upload-box span.info-box{margin-left:16px}.img-upload-box span.info-box img.info-box{display:block;width:316px;height:auto}.img-upload-box span.info-box span.operate-box{display:-webkit-box;display:-ms-flexbox;display:flex;margin-top:16px;line-height:20px}.img-upload-box span.info-box span.operate-box span.upload-msg{font-size:14px;color:#ca0c16;width:100%;text-align:center}.img-upload-box span.info-box span.operate-box a.btn{margin-left:auto;font-size:14px;color:#999;white-space:nowrap;cursor:pointer}.img-upload-box span.info-box span.operate-box a.btn.btn-redo{display:none;margin-right:16px}
.cke_show_borders  table.cke_show_border,.cke_show_borders  table.cke_show_border > tr > td, .cke_show_borders  table.cke_show_border > tr > th,.cke_show_borders  table.cke_show_border > tbody > tr > td, .cke_show_borders  table.cke_show_border > tbody > tr > th,.cke_show_borders  table.cke_show_border > thead > tr > td, .cke_show_borders  table.cke_show_border > thead > tr > th,.cke_show_borders  table.cke_show_border > tfoot > tr > td, .cke_show_borders  table.cke_show_border > tfoot > tr > th{border : #d3d3d3 1px dotted}
.cke_widget_wrapper{position:relative;outline:none}.cke_widget_inline{display:inline-block}.cke_widget_wrapper:hover>.cke_widget_element{outline:2px solid #ffd25c;cursor:default}.cke_widget_wrapper:hover .cke_widget_editable{outline:2px solid #ffd25c}.cke_widget_wrapper.cke_widget_focused>.cke_widget_element,.cke_widget_wrapper .cke_widget_editable.cke_widget_editable_focused{outline:2px solid #47a4f5}.cke_widget_editable{cursor:text}.cke_widget_drag_handler_container{position:absolute;width:15px;height:0;display:none;opacity:0.75;transition:height 0s 0.2s;line-height:0}.cke_widget_wrapper:hover>.cke_widget_drag_handler_container{height:15px;transition:none}.cke_widget_drag_handler_container:hover{opacity:1}img.cke_widget_drag_handler{cursor:move;width:15px;height:15px;display:inline-block}.cke_widget_mask{position:absolute;top:0;left:0;width:100%;height:100%;display:block}.cke_editable.cke_widget_dragging, .cke_editable.cke_widget_dragging *{cursor:move !important}
.cke_image_nocaption{line-height:0}.cke_editable.cke_image_sw, .cke_editable.cke_image_sw *{cursor:sw-resize !important}.cke_editable.cke_image_se, .cke_editable.cke_image_se *{cursor:se-resize !important}.cke_image_resizer{display:none;position:absolute;width:10px;height:10px;bottom:-5px;right:-5px;background:#000;outline:1px solid #fff;line-height:0;cursor:se-resize;}.cke_image_resizer_wrapper{position:relative;display:inline-block;line-height:0;}.cke_image_resizer.cke_image_resizer_left{right:auto;left:-5px;cursor:sw-resize;}.cke_widget_wrapper:hover .cke_image_resizer,.cke_image_resizer.cke_image_resizing{display:block}.cke_widget_wrapper>a{display:inline-block}
.cke_upload_uploading img{opacity: 0.3}</style></head><body class="htmledit_views cke_editable cke_editable_themed cke_contents_ltr cke_show_borders" contenteditable="true" spellcheck="false"><p>了解四次挥手前，需要先了解三次握手。握手相见，挥手再见。</p><p>第一次：客户端发出连接释放报文，FIN=1， seq=u(等于前面已经传送过来的数据的最后一个字节的序号加1), 此时。客户端进入FIN-WAIT-1（终止等待1）状态。</p><p>第二次：服务器收到连接释放报文，发出确认报文，ACK=1，ack=u+1, seq=v;此时服务端进入了CLOSE-WAIT（关闭等待）状态。</p><p>(客户端收到第二次挥手中服务器的确认请求后，就进入了FIN-WAIT-2终止等待2状态，等待服务器发送连接释放报文,在这个状态还需要接受服务器发送的最后的数据)</p><p>第三次：服务器数据发送完毕，开始发送连接释放报文，FIN=1，ack=u+1，seq=w。此后服务器进入LAST-ACK最后确认状态，等待客户端的确认。</p><p>第四次：客户端收到服务器的释放报文，发出确认。ACK=1， ack=w+1, seq=u+1.完了之后，客户端进入时间为2*MSL的TIME-WAIT时间等待状态，其中MSL为最长报文段的寿命。</p><p>(之后服务端收到了第四次中客户端的确认后，立即进入CLOSED状态)</p><h1>什么客户端最后还要等待2MSL？</h1><blockquote><p>MSL（Maximum Segment Lifetime），TCP允许不同的实现可以设置不同的MSL值。第一，保证客户端发送的最后一个ACK报文能够到达服务器，因为这个ACK报文可能丢失，站在服务器的角度看来，我已经发送了FIN+ACK报文请求断开了，客户端还没有给我回应，应该是我发送的请求断开报文它没有收到，于是服务器又会重新发送一次，而客户端就能在这个2MSL时间段内收到这个重传的报文，接着给出回应报文，并且会重启2MSL计时器。第二，防止类似与“三次握手”中提到了的“已经失效的连接请求报文段”出现在本连接中。客户端发送完最后一个确认报文后，在这个2MSL时间中，就可以使本连接持续的时间内所产生的所有报文段都从网络中消失。这样新的连接中不会出现旧连接的请求报文。为什么建立连接是三次握手，关闭连接确是四次挥手呢？建立连接的时候， 服务器在LISTEN状态下，收到建立连接请求的SYN报文后，把ACK和SYN放在一个报文里发送给客户端。 而关闭连接时，服务器收到对方的FIN报文时，仅仅表示对方不再发送数据了但是还能接收数据，而自己也未必全部数据都发送给对方了，所以己方可以立即关闭，也可以发送一些数据给对方后，再发送FIN报文给对方来表示同意现在关闭连接，因此，己方ACK和FIN一般都会分开发送，从而导致多了一次。</p></blockquote><h1>如果已经建立了连接，但是客户端突然出现故障了怎么办？</h1><blockquote><p>TCP还设有一个保活计时器，显然，客户端如果出现故障，服务器不能一直等下去，白白浪费资源。服务器每收到一次客户端的请求后都会重新复位这个计时器，时间通常是设置为2小时，若两小时还没有收到客户端的任何数据，服务器就会发送一个探测报文段，以后每隔75分钟发送一次。若一连发送10个探测报文仍然没反应，服务器就认为客户端出了故障，接着就关闭连接。</p></blockquote> </body></html>